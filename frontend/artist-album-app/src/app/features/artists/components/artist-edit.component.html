<app-header title="Editar Artista"></app-header>

<div class="min-h-screen bg-gradient-to-br from-spotify-black via-spotify-gray-dark to-spotify-black">
  <div class="container mx-auto px-4 py-8">
    <!-- Back Button -->
    <button 
      (click)="goBack()"
      class="mb-6 flex items-center gap-2 px-4 py-2.5 bg-spotify-gray-medium hover:bg-spotify-gray-light text-spotify-white rounded-lg transition-all font-bold shadow-spotify border border-spotify-gray-light"
    >
      <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      <span>Voltar</span>
    </button>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-center items-center py-20">
      <div class="animate-spin rounded-full h-12 w-12 border-4 border-spotify-gray-light border-t-spotify-green"></div>
    </div>

    <!-- Artist Not Found -->
    <div *ngIf="!loading && !artist" class="card p-8 text-center bg-spotify-gray-medium border-2 border-spotify-gray-light rounded-xl">
      <svg class="h-16 w-16 mx-auto text-spotify-gray-lighter mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <h3 class="text-xl font-bold text-spotify-white mb-2">Artista não encontrado</h3>
      <p class="text-spotify-gray-lighter">O artista que você está procurando não existe ou foi removido.</p>
    </div>

    <!-- Edit Form -->
    <div *ngIf="!loading && artist" class="space-y-6 fade-in">
      <!-- Artist Info Card -->
      <div class="card p-8 bg-spotify-gray-medium border-2 border-spotify-gray-light rounded-xl shadow-spotify">
        <!-- Header com Avatar -->
        <div class="flex items-center gap-6 mb-8 pb-6 border-b-2 border-spotify-gray-light">
          <div class="w-20 h-20 bg-gradient-to-br from-spotify-green to-spotify-green-dark rounded-full flex items-center justify-center flex-shrink-0 shadow-lg">
            <span class="text-spotify-black text-3xl font-bold">{{ artist.name.charAt(0).toUpperCase() }}</span>
          </div>
          <div class="flex-1">
            <h1 class="text-3xl font-bold text-spotify-white mb-1 flex items-center gap-3">
              <svg class="h-8 w-8 text-spotify-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
              Editar Artista
            </h1>
            <p class="text-spotify-gray-lighter font-medium">Atualize as informações de <span class="text-spotify-green">{{ artist.name }}</span></p>
          </div>
        </div>

        <!-- Artist Form -->
        <div class="space-y-6">
          <!-- Nome -->
          <div>
            <label class="block text-sm font-bold text-spotify-white mb-2">
              Nome do Artista <span class="text-red-500">*</span>
            </label>
            <input
              [(ngModel)]="artistName"
              type="text"
              placeholder="Ex: System of a Down, Metallica..."
              minlength="3"
              class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all placeholder-spotify-text-muted"
            />
            <p class="text-xs text-spotify-text-muted mt-1.5 flex items-center gap-1">
              <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              Mínimo 3 caracteres
            </p>
          </div>

          <!-- Tipo e País (Grid) -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-bold text-spotify-white mb-2">Tipo de Artista</label>
              <div class="relative">
                <input
                  [(ngModel)]="artistType"
                  type="text"
                  placeholder="Solo, Banda, Duo..."
                  maxlength="100"
                  class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all placeholder-spotify-text-muted"
                />
                <svg class="absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-spotify-gray-lighter pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
              </div>
            </div>

            <div>
              <label class="block text-sm font-bold text-spotify-white mb-2">País de Origem</label>
              <div class="relative">
                <input
                  [(ngModel)]="artistCountry"
                  type="text"
                  placeholder="Estados Unidos, Brasil..."
                  maxlength="100"
                  class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all placeholder-spotify-text-muted"
                />
                <svg class="absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-spotify-gray-lighter pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
            </div>
          </div>

          <!-- Biografia -->
          <div>
            <label class="block text-sm font-bold text-spotify-white mb-2 flex items-center gap-2">
              <svg class="h-5 w-5 text-spotify-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              Biografia
            </label>
            <textarea
              [(ngModel)]="artistBiography"
              rows="5"
              placeholder="Conte um pouco sobre a história, estilo musical e principais conquistas do artista..."
              class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all resize-none placeholder-spotify-text-muted leading-relaxed"
            ></textarea>
            <p class="text-xs text-spotify-text-muted mt-1.5">Descreva o artista de forma interessante e informativa</p>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-end gap-3 mt-8 pt-6 border-t-2 border-spotify-gray-light">
          <button
            (click)="cancel()"
            class="btn-secondary px-6"
            [disabled]="saving"
          >
            Cancelar
          </button>
          <button
            (click)="saveArtist()"
            [disabled]="!artistName || artistName.trim().length < 3 || saving"
            [class.opacity-30]="!artistName || artistName.trim().length < 3 || saving"
            [class.cursor-not-allowed]="!artistName || artistName.trim().length < 3 || saving"
            class="btn-primary px-6 flex items-center gap-2"
          >
            <svg *ngIf="saving" class="animate-spin h-5 w-5" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <svg *ngIf="!saving" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            {{ saving ? 'Salvando...' : 'Salvar Alterações' }}
          </button>
        </div>
      </div>

      <!-- Albums Section -->
      <div class="card p-8 bg-spotify-gray-medium border-2 border-spotify-gray-light rounded-xl shadow-spotify">
        <div class="flex items-center justify-between mb-6 pb-6 border-b-2 border-spotify-gray-light">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-spotify-green/20 rounded-full flex items-center justify-center border border-spotify-green/30">
              <svg class="h-6 w-6 text-spotify-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
              </svg>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-spotify-white">Álbuns do Artista</h2>
              <p class="text-spotify-gray-lighter mt-1 font-medium">
                <span class="text-spotify-green font-bold">{{ albums.length }}</span> {{ albums.length === 1 ? 'álbum cadastrado' : 'álbuns cadastrados' }}
              </p>
            </div>
          </div>
          <button
            (click)="toggleAddAlbumForm()"
            class="btn-primary px-6 flex items-center gap-2 shadow-lg hover:shadow-spotify transition-all"
            [class.bg-red-500]="showAddAlbumForm"
            [class.hover:bg-red-600]="showAddAlbumForm"
          >
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path *ngIf="!showAddAlbumForm" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              <path *ngIf="showAddAlbumForm" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            {{ showAddAlbumForm ? 'Cancelar' : 'Adicionar Álbum' }}
          </button>
        </div>

        <!-- Add Album Form -->
        <div *ngIf="showAddAlbumForm" class="mb-6 p-6 bg-spotify-gray-medium rounded-xl border-2 border-spotify-gray-light animate-fadeIn">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-spotify-white flex items-center gap-2">
              <svg class="h-6 w-6 text-spotify-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Adicionar Novo Álbum
            </h3>
            <button
              (click)="toggleAddAlbumForm()"
              class="p-2 text-spotify-gray-lighter hover:text-spotify-white rounded-lg transition"
            >
              <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          
          <div class="space-y-6">
            <!-- Upload de Capa (Destaque) -->
            <div>
              <label class="block text-sm font-bold text-spotify-white mb-3">Capa do Álbum</label>
              
              <!-- Preview or Upload Area -->
              <div *ngIf="!newAlbumCoverPreview" 
                   class="border-2 border-dashed border-spotify-gray-light rounded-xl p-8 text-center hover:border-spotify-green hover:bg-spotify-gray-dark/50 transition-all cursor-pointer group"
                   (click)="coverFileInput.click()">
                <svg class="h-16 w-16 mx-auto text-spotify-gray-lighter group-hover:text-spotify-green transition mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <p class="text-spotify-white font-bold mb-2">Clique para selecionar a capa</p>
                <p class="text-sm text-spotify-gray-lighter">ou arraste e solte aqui</p>
                <p class="text-xs text-spotify-text-muted mt-2">PNG, JPG até 5MB</p>
              </div>

              <!-- Preview da capa -->
              <div *ngIf="newAlbumCoverPreview" class="relative group">
                <img [src]="newAlbumCoverPreview" alt="Preview" class="w-full h-64 object-cover rounded-xl shadow-spotify">
                <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity rounded-xl flex items-center justify-center gap-3">
                  <button
                    type="button"
                    (click)="coverFileInput.click()"
                    class="px-4 py-2 bg-spotify-green text-spotify-black font-bold rounded-full hover:bg-spotify-green-hover transition"
                  >
                    Trocar Imagem
                  </button>
                  <button
                    type="button"
                    (click)="removeCoverPreview()"
                    class="px-4 py-2 bg-red-500 text-white font-bold rounded-full hover:bg-red-600 transition"
                  >
                    Remover
                  </button>
                </div>
              </div>

              <input
                #coverFileInput
                type="file"
                accept="image/*"
                (change)="onCoverFileSelected($event)"
                class="hidden"
              />
            </div>

            <!-- Informações do Álbum -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
              <!-- Título -->
              <div class="lg:col-span-2">
                <label class="block text-sm font-bold text-spotify-white mb-2">
                  Título do Álbum <span class="text-red-500">*</span>
                </label>
                <input
                  [(ngModel)]="newAlbumTitle"
                  type="text"
                  placeholder="Ex: Toxicity, The Dark Side of the Moon..."
                  minlength="3"
                  class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all placeholder-spotify-text-muted"
                />
                <p class="text-xs text-spotify-text-muted mt-1">Mínimo 3 caracteres</p>
              </div>

              <!-- Ano de Lançamento -->
              <div>
                <label class="block text-sm font-bold text-spotify-white mb-2">Ano de Lançamento</label>
                <input
                  [(ngModel)]="newAlbumYear"
                  type="number"
                  min="1900"
                  max="2100"
                  placeholder="2024"
                  class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all"
                />
              </div>

              <!-- Gênero -->
              <div>
                <label class="block text-sm font-bold text-spotify-white mb-2">Gênero</label>
                <input
                  [(ngModel)]="newAlbumGenre"
                  type="text"
                  placeholder="Rock, Pop, Jazz, Metal..."
                  maxlength="100"
                  class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all placeholder-spotify-text-muted"
                />
              </div>

              <!-- Gravadora -->
              <div class="lg:col-span-2">
                <label class="block text-sm font-bold text-spotify-white mb-2">Gravadora</label>
                <input
                  [(ngModel)]="newAlbumRecordLabel"
                  type="text"
                  placeholder="Universal Music, Sony Music, Warner..."
                  maxlength="200"
                  class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all placeholder-spotify-text-muted"
                />
              </div>

              <!-- Número de Faixas -->
              <div>
                <label class="block text-sm font-bold text-spotify-white mb-2">Número de Faixas</label>
                <input
                  [(ngModel)]="newAlbumTotalTracks"
                  type="number"
                  min="1"
                  placeholder="12"
                  class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all"
                />
              </div>

              <!-- Duração Total -->
              <div>
                <label class="block text-sm font-bold text-spotify-white mb-2">
                  Duração Total (segundos)
                  <span class="text-spotify-text-muted font-normal text-xs ml-1">(ex: 40min = 2400s)</span>
                </label>
                <input
                  [(ngModel)]="newAlbumTotalDuration"
                  type="number"
                  min="1"
                  placeholder="2400"
                  class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all"
                />
              </div>
            </div>

            <!-- Buttons -->
            <div class="flex justify-end gap-3 pt-6 border-t border-spotify-gray-light">
              <button
                (click)="toggleAddAlbumForm()"
                class="btn-secondary px-6"
              >
                Cancelar
              </button>
              <button
                (click)="createAlbum()"
                [disabled]="!newAlbumTitle || newAlbumTitle.trim().length < 3"
                [class.opacity-30]="!newAlbumTitle || newAlbumTitle.trim().length < 3"
                [class.cursor-not-allowed]="!newAlbumTitle || newAlbumTitle.trim().length < 3"
                class="btn-primary px-6 flex items-center gap-2"
              >
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                Criar Álbum
              </button>
            </div>
          </div>
        </div>

        <!-- No Albums Message -->
        <div *ngIf="albums.length === 0 && !showAddAlbumForm" class="text-center py-16">
          <div class="inline-flex items-center justify-center w-24 h-24 bg-spotify-gray-dark rounded-full mb-6 border-2 border-dashed border-spotify-gray-light">
            <svg class="h-12 w-12 text-spotify-gray-lighter" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-spotify-white mb-2">Nenhum álbum cadastrado</h3>
          <p class="text-spotify-gray-lighter mb-6 max-w-md mx-auto">
            Adicione o primeiro álbum deste artista para começar a construir sua discografia.
          </p>
          <button
            (click)="toggleAddAlbumForm()"
            class="btn-primary px-6 inline-flex items-center gap-2"
          >
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Adicionar Primeiro Álbum
          </button>
        </div>

        <!-- Albums List -->
        <div *ngIf="albums.length > 0" class="space-y-3">
          <div 
            *ngFor="let album of albums; let i = index"
            class="border-2 border-spotify-gray-light rounded-xl overflow-hidden hover:border-spotify-green/30 transition-all bg-spotify-gray-dark"
          >
            <!-- Album Header (Clickable) -->
            <button
              (click)="toggleAlbum(album.id)"
              class="w-full px-6 py-4 flex items-center justify-between hover:bg-spotify-gray-medium/50 transition text-left"
            >
              <div class="flex items-center gap-4 flex-1">
                <!-- Album Number -->
                <div class="w-10 h-10 bg-spotify-green/20 rounded-full flex items-center justify-center flex-shrink-0 border border-spotify-green/30">
                  <span class="text-spotify-green font-bold">{{ i + 1 }}</span>
                </div>

                <!-- Album Info -->
                <div class="flex-1">
                  <h3 class="text-lg font-bold text-spotify-white">{{ album.title }}</h3>
                  <div class="flex items-center gap-3 mt-1 flex-wrap">
                    <span *ngIf="album.releaseYear" class="text-sm text-spotify-gray-lighter flex items-center gap-1">
                      <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                      {{ album.releaseYear }}
                    </span>
                    <span *ngIf="album.genre" class="px-2 py-1 text-xs font-bold bg-spotify-green/20 text-spotify-green rounded-full border border-spotify-green/30">
                      {{ album.genre }}
                    </span>
                    <span *ngIf="album.totalTracks" class="text-sm text-spotify-gray-lighter flex items-center gap-1">
                      <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                      </svg>
                      {{ album.totalTracks }} {{ album.totalTracks === 1 ? 'faixa' : 'faixas' }}
                    </span>
                    <span *ngIf="album.covers && album.covers.length > 0" class="text-sm text-spotify-text-muted flex items-center gap-1">
                      <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                      {{ album.covers.length }} {{ album.covers.length === 1 ? 'capa' : 'capas' }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Chevron Icon -->
              <svg 
                class="h-6 w-6 text-spotify-gray-lighter transition-transform duration-200"
                [class.rotate-180]="isAlbumExpanded(album.id)"
                fill="none" 
                stroke="currentColor" 
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>

            <!-- Album Details (Expandable) -->
            <div 
              *ngIf="isAlbumExpanded(album.id)"
              class="px-6 pb-6 pt-2 bg-spotify-gray-medium border-t-2 border-spotify-gray-light animate-fadeIn"
            >
              <!-- Edit Mode -->
              <div *ngIf="isEditingAlbum(album.id)" class="space-y-4 mb-4">
                <div class="flex items-center justify-between mb-4">
                  <h4 class="font-bold text-spotify-white flex items-center gap-2">
                    <svg class="h-5 w-5 text-spotify-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    Editando Álbum
                  </h4>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                  <!-- Título -->
                  <div class="lg:col-span-2">
                    <label class="block text-sm font-bold text-spotify-white mb-2">
                      Título <span class="text-red-500">*</span>
                    </label>
                    <input
                      [(ngModel)]="editAlbumTitle"
                      type="text"
                      minlength="3"
                      class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all"
                    />
                  </div>

                  <!-- Ano -->
                  <div>
                    <label class="block text-sm font-bold text-spotify-white mb-2">Ano</label>
                    <input
                      [(ngModel)]="editAlbumYear"
                      type="number"
                      min="1900"
                      max="2100"
                      class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all"
                    />
                  </div>

                  <!-- Gênero -->
                  <div>
                    <label class="block text-sm font-bold text-spotify-white mb-2">Gênero</label>
                    <input
                      [(ngModel)]="editAlbumGenre"
                      type="text"
                      maxlength="100"
                      class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all"
                    />
                  </div>

                  <!-- Gravadora -->
                  <div class="lg:col-span-2">
                    <label class="block text-sm font-bold text-spotify-white mb-2">Gravadora</label>
                    <input
                      [(ngModel)]="editAlbumRecordLabel"
                      type="text"
                      maxlength="200"
                      class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all"
                    />
                  </div>

                  <!-- Faixas -->
                  <div>
                    <label class="block text-sm font-bold text-spotify-white mb-2">Número de Faixas</label>
                    <input
                      [(ngModel)]="editAlbumTotalTracks"
                      type="number"
                      min="1"
                      class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all"
                    />
                  </div>

                  <!-- Duração -->
                  <div>
                    <label class="block text-sm font-bold text-spotify-white mb-2">Duração (seg)</label>
                    <input
                      [(ngModel)]="editAlbumTotalDuration"
                      type="number"
                      min="1"
                      class="w-full px-4 py-3 bg-spotify-gray-dark border border-spotify-gray-light text-spotify-white rounded-lg focus:outline-none focus:border-spotify-green hover:border-spotify-gray-lighter transition-all"
                    />
                  </div>
                </div>

                <!-- Edit Buttons -->
                <div class="flex justify-end gap-3 pt-4 border-t border-spotify-gray-light">
                  <button
                    (click)="cancelEditAlbum()"
                    class="btn-secondary px-6"
                  >
                    Cancelar
                  </button>
                  <button
                    (click)="saveEditAlbum(album)"
                    [disabled]="!editAlbumTitle || editAlbumTitle.trim().length < 3"
                    [class.opacity-30]="!editAlbumTitle || editAlbumTitle.trim().length < 3"
                    class="btn-primary px-6 flex items-center gap-2"
                  >
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Salvar Alterações
                  </button>
                </div>
              </div>

              <!-- View Mode -->
              <div *ngIf="!isEditingAlbum(album.id)">
                <!-- Action Buttons -->
                <div class="flex justify-end gap-2 mb-4">
                  <button
                    (click)="startEditAlbum(album)"
                    class="px-4 py-2 bg-spotify-green/20 text-spotify-green font-bold rounded-lg hover:bg-spotify-green/30 transition flex items-center gap-2 border border-spotify-green/30"
                  >
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    Editar
                  </button>
                  <button
                    (click)="deleteAlbum(album)"
                    class="px-4 py-2 bg-red-500/20 text-red-400 font-bold rounded-lg hover:bg-red-500/30 transition flex items-center gap-2 border border-red-500/30"
                  >
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    Deletar
                  </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                  <!-- Cover Principal (Fixo) -->
                  <div class="lg:col-span-1">
                    <h4 class="font-bold text-spotify-white mb-3 flex items-center gap-2">
                      <svg class="h-5 w-5 text-spotify-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                      Capa Principal
                    </h4>
                    <div *ngIf="!album.covers || album.covers.length === 0" class="flex items-center justify-center h-64 bg-spotify-gray-dark rounded-xl border-2 border-dashed border-spotify-gray-light">
                      <div class="text-center">
                        <svg class="h-16 w-16 mx-auto text-spotify-gray-lighter mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="text-sm text-spotify-text-muted font-medium">Sem capa</p>
                      </div>
                    </div>
                    <img 
                      *ngIf="getMainCover(album)"
                      [src]="getMainCover(album)" 
                      [alt]="album.title"
                      class="w-full h-64 object-cover rounded-xl shadow-spotify border border-spotify-gray-light"
                    />
                  </div>

                  <!-- Album Information + Carousel -->
                  <div class="lg:col-span-2 space-y-6">
                    <!-- Information -->
                    <div>
                      <h4 class="font-bold text-spotify-white mb-3 flex items-center gap-2">
                        <svg class="h-5 w-5 text-spotify-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Informações
                      </h4>
                      <div class="grid grid-cols-2 gap-4 bg-spotify-gray-dark p-4 rounded-lg">
                        <div *ngIf="album.recordLabel" class="col-span-2 md:col-span-1">
                          <span class="text-xs text-spotify-text-muted font-bold uppercase tracking-wide">Gravadora</span>
                          <p class="text-sm text-spotify-white font-medium mt-1">{{ album.recordLabel }}</p>
                        </div>

                        <div *ngIf="album.totalDurationSeconds" class="col-span-2 md:col-span-1">
                          <span class="text-xs text-spotify-text-muted font-bold uppercase tracking-wide">Duração</span>
                          <p class="text-sm text-spotify-white font-medium mt-1">
                            {{ Math.floor(album.totalDurationSeconds / 60) }}:{{ (album.totalDurationSeconds % 60).toString().padStart(2, '0') }} min
                          </p>
                        </div>

                        <div class="col-span-2 md:col-span-1">
                          <span class="text-xs text-spotify-text-muted font-bold uppercase tracking-wide">Criado em</span>
                          <p class="text-sm text-spotify-white font-medium mt-1">{{ album.createdAt | date: 'dd/MM/yyyy' }}</p>
                        </div>

                        <div class="col-span-2 md:col-span-1">
                          <span class="text-xs text-spotify-text-muted font-bold uppercase tracking-wide">Atualizado em</span>
                          <p class="text-sm text-spotify-white font-medium mt-1">{{ album.updatedAt | date: 'dd/MM/yyyy' }}</p>
                        </div>
                      </div>
                    </div>

                    <!-- Carousel de Covers (Pequeno) -->
                    <div *ngIf="album.covers && album.covers.length > 1">
                      <h4 class="font-bold text-spotify-white mb-3 flex items-center gap-2">
                        <svg class="h-5 w-5 text-spotify-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        Outras Capas
                        <span class="text-sm font-normal text-spotify-text-muted">
                          ({{ getCurrentCoverIndex(album.id) + 1 }} de {{ album.covers.length }})
                        </span>
                      </h4>
                      
                      <div class="relative">
                        <img 
                          [src]="getCurrentCover(album)" 
                          [alt]="album.title"
                          class="w-full h-48 object-cover rounded-lg shadow-spotify border border-spotify-gray-light"
                        />

                        <!-- Carousel Controls -->
                        <div class="absolute inset-0 flex items-center justify-between px-2">
                          <button 
                            (click)="previousCover(album, $event)"
                            class="bg-black/70 hover:bg-spotify-green/90 text-white rounded-full p-2 transition border border-white/20"
                          >
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                          </button>
                          <button 
                            (click)="nextCover(album, $event)"
                            class="bg-black/70 hover:bg-spotify-green/90 text-white rounded-full p-2 transition border border-white/20"
                          >
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                          </button>
                        </div>

                        <!-- Dots Indicator -->
                        <div class="flex justify-center gap-1.5 mt-2">
                          <button
                            *ngFor="let cover of album.covers; let idx = index"
                            (click)="currentCoverIndexMap.set(album.id, idx)"
                            class="w-2 h-2 rounded-full transition"
                            [class.bg-spotify-green]="getCurrentCoverIndex(album.id) === idx"
                            [class.bg-spotify-gray-light]="getCurrentCoverIndex(album.id) !== idx"
                          ></button>
                        </div>
                      </div>
                    </div>

                    <div *ngIf="!album.covers || album.covers.length <= 1">
                      <p class="text-sm text-spotify-text-muted italic">Não há outras capas para este álbum.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
